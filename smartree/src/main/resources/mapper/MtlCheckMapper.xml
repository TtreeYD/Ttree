<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.yedam.smartree.check.mapper.MtlCheckMapper">
  	<select id="selectAll" resultType="MtlCheckVO">
  		SELECT c.mtl_chk_code, c.mtl_chk_date, c.mtl_date, n.mtl_code, n.bp_code, n.mtl_name, c.mtl_chk_cnt, c.mtl_error_cnt , c.mtl_pass_cnt, c.mtl_chk_manager
		FROM mtl_chk c 
		JOIN mtl_need n ON c.mtl_code = n.mtl_code
		order by mtl_chk_code ASC
  	</select>
  
  	<select id="selectMtl" resultType="MtlCheckVO">
  		SELECT	mtl_date, 
	  			mtl_code, 
	  			bp_code, 
	  			mtl_name, 
	  			mtl_manager
		FROM	mtl_need
        <where>
          <if test="mtlDate != null">
             mtl_date >= #{mtlDate} AND mtl_date <![CDATA[<]]> #{mtlDate}+1
          </if>
          <if test="bpCode != null and !bpCode.equals('')">
            AND bp_code = #{bpCode}
          </if>
          <if test="mtlCode != null and !mtlCode.equals('')">
            AND mtl_code = #{mtlCode}
          </if>
          <if test="mtlManager != null and !mtlManager.equals('')">
            AND mtl_manager LIKE '%' || #{mtlManager} ||'%'
          </if>
      </where> 	
  	</select>
  	
  	<select id="getMtl" resultType="MtlCheckVO">
	  	SELECT c.mtl_chk_code, 
	  			c.mtl_chk_date, 
	  			c.mtl_date, 
	  			n.mtl_code, 
	  			n.bp_code, 
	  			n.mtl_name, 
	  			c.mtl_chk_cnt, 
	  			c.mtl_error_cnt , 
	  			c.mtl_pass_cnt, 
	  			c.mtl_chk_manager
		FROM mtl_chk c 
		JOIN mtl_need n ON c.mtl_code = n.mtl_code
		where bp_code = #{bpCode}
		and mtl_date BETWEEN #{mtlDate} AND #{mtlDate}+1
	  	
  	</select>
  	
  	
  	
  	<insert id="insertChkMtl" parameterType="MtlCheckVO">
  		insert into mtl_chk(
  		                mtl_chk_code,
  		                mtl_code , 
  		                mtl_chk_cnt,
  		                mtl_error_cnt,
  		                mtl_pass_cnt,
  		                mtl_chk_manager)
  		values  ( 'MTC' || LPAD(mtl_chk_seq.NEXTVAL, 5, '0')
  				,#{mtlCode} 
  				 ,#{mtlChkCnt} 
  				 ,#{mtlErrorCnt}
  				 ,#{mtlPassCnt}
  				 ,#{mtlChkManager})
  	</insert>
  	
  <select id="searchMtl" resultType="MtlCheckVO">
  	 SELECT c.mtl_chk_code, c.mtl_chk_date, c.mtl_date, n.mtl_code, n.bp_code, n.mtl_name, c.mtl_chk_cnt, c.mtl_error_cnt , c.mtl_pass_cnt, c.mtl_chk_manager
		FROM mtl_chk c 
		JOIN mtl_need n ON c.mtl_code = n.mtl_code
		
  		<where>
  			<if test="mtlChkCode != null and !mtlChkCode.equals('')">
  				mtl_chk_code LIKE '%'||#{mtlChkCode}||'%'
  			</if>
  		</where>  	
		order by mtl_chk_code ASC	 
  	</select>
  	
  	
  	<select id="searchMtlDate" resultType="MtlCheckVO">
  	 SELECT c.mtl_chk_code, c.mtl_chk_date, c.mtl_date, n.mtl_code, n.bp_code, n.mtl_name, c.mtl_chk_cnt, c.mtl_error_cnt , c.mtl_pass_cnt, c.mtl_chk_manager
		FROM mtl_chk c 
		JOIN mtl_need n ON c.mtl_code = n.mtl_code
		
  		<where>
  			<if test="mtlChkDate != null and !mtlChkDate.equals('')">
  				mtl_chk_date LIKE '%'||#{mtlChkDate}||'%'
  			</if>
  		</where>  	
		order by mtl_chk_code 	 
  	</select>
  	
	<select id="selectChkAll" resultType="MtlCheckVO">
		SELECT *
		FROM mtl_chk c 
		JOIN mtl_need n ON c.mtl_code = n.mtl_code
		order by mtl_chk_code 
  	</select>
  	
  </mapper>