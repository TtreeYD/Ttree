<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.yedam.smartree.check.mapper.CheckMapper">
  
  	<!-- 제품목록 -->
  	<select id="selectPrdtList" resultType="BpVO">
  		select prdt_code,
  			   prdt_name,
  			   prdt_type
  		from prdt_table
  		<where>
  			<if test="prdtCode != null">
  				prdt_code = #{prdtCode}
  			</if>
  		</where>
  	</select>
  	
  	<!-- 제품검사기준목록 -->
  	<select id="selectPrdtStdList" resultType="CheckVO">
  		select chk_std_code,
  		       chk_name,
  		       chk_dt,
  		       chk_std
  		from chk_std
  		<where>
  			<if test="chkStdCode != null">
  				chk_std_code = #{chkStdCode}
  			</if>
  		</where>
  	</select>
  
  	<insert id="insertPrdtChkStd" parameterType="CheckVO">
  		insert into prdt_chk_list(chk_std_code, prdt_chk_num, prdt_code, chk_std)
  		values (
  			#{chkStdCode},
  			#{prdtChkNum},
  			#{prdtCode},
  			#{chkStd}
  		) 

  	</insert>
  
  <!-- 완제품검사목록 -->
  <select id="selectProdCheckList" resultType="CheckVO">
  	select p.pass_cnt, 
  		   p.prcs_rs_code,
  		   p.prdt_code,
  		    
  		   d.prod_inst_code, 
  		   
  		   i.prod_inst_date
	from process_result p
	JOIN process r 
	  ON p.prcs_code = r.prcs_code
    JOIN dt_prod_inst d 
      ON r.dt_prod_inst_code = d.dt_prod_inst_code
    JOIN prod_inst i 
      ON d.prod_inst_code = i.prod_inst_code
      
	WHERE r.prod_yn = 'y'

  </select>
  
  <!-- 완제품검사상세목록 -->
  <select id="selectProdDtList" resultType="CheckVO">
  SELECT 
         s.chk_name, 
         s.chk_std,
         
         p.prcs_rs_code,
         
         c.prdt_chk_num
  FROM prdt_chk p 
  JOIN dt_prdt_chk d
    ON p.prdt_chk_code = d.prdt_chk_code
  JOIN prdt_chk_list c
    ON d.chk_std_code = c.chk_std_code
  JOIN chk_std s
    ON c.chk_std_code = s.chk_std_code
  
   WHERE c.prdt_code = #{prdtCode}
   	 AND p.prcs_rs_code = #{prcsRsCode}
  </select>  
  
  <!-- 완제품검사조회목록 -->
  <select id="selectPrdtCheckList" resultType="CheckVO">
  	select *
  	from prdt_chk
  </select>
  
  <!-- 완제품검사상세조회목록 -->
  <select id="selectdtList" resultType="CheckVO">
  SELECT p.prdt_chk_code, 
         p.prdt_code, 
         p.prcs_rs_code,
          
         c.chk_name, 
         c.chk_std,
          
         d.prdt_chk_val, 
         d.prdt_chk_result
         
    FROM prdt_chk p 
    JOIN dt_prdt_chk d 
      ON p.prdt_chk_code = d.prdt_chk_code
    JOIN chk_std c 
      ON d.chk_std_code = c.chk_std_code
  
   WHERE p.prdt_chk_code = #{prdtChkCode}
  </select>
  
  </mapper>