<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<meta charset="UTF-8">
<title>자재발주관리</title>

</head>
<body>
	<div layout:fragment="content">
	<h3>자재발주관리</h3>	
		<a href="javascript:pop()" style="margin:20px">안전재고미달목록<a>
		<div id="mtlLowGrid"></div>
		<br>
		<div class="col-14">
				<div class="btn-group" role="group" aria-label="Basic example" style="float:right;">
			<button type="button" id="mtlSearch" class="btn btn-primary" data-toggle="modal" data-target="#myModal">조회</button>
			<button type="button" id="mtlSave" class="btn btn-primary">발주</button>
		</div>
		<div id="mtlNeedGrid"></div>
			<div id="myModal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog modal-xl" role="document">
				<div class="modal-content" style="height: 700px">
					<div class="container text-center">
					<br>
						<h2>발주관리</h2>
						<div class="modal-header row justify-content-evenly">
							<div class="col-6">
								<div class="d-flex flex-column align-items-center">
									<div class="mb-3">
										<span>자재발주일</span>
										<div class="input-group">
											<input class="form-control" id="mtlDate" type="date" style="width: 150px;">
											<input class="form-control" id="mtlDate" type="date" style="width: 150px;">
									</div>		
									</div>
									<div>
									<span>납기요청일</span>
									<div class="input-group">
										 <input class="form-control" id="mtlWishDate" type="date" style="width: 150px;">
										 <input class="form-control" id="mtlWishDate" type="date" style="width: 150px;">
									</div>
									</div>
								</div>
							</div>
							<div class="col-6">
								<div class="d-flex flex-column align-items-center">
									<div class="mb-3">
										<span>자재이름</span> <input class="form-control" id="mtlName"	type="text" style="width: 300px;">
										<span>담당자</span> <input class="form-control" id="mtlManager" type="text" style="width: 300px;">
									</div>
								</div>
							</div>
						</div>
					</div>
					<div style="display: flex; justify-content: center;">
						<button type="button" id="searchDataBtn" class="btn btn-primary"
							style="margin: 5px;">조회</button>
						<button type="button" id="resetModalBtn" class="btn btn-primary"
							style="margin: 4px;">초기화</button>
					</div>
					<div class="modal-body">
						<div id="needModalGrid"></div>
					</div>
					<div class="modal-footer">
						<button type="button" id="addModalBtn" class="btn btn-default">저장</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->
		<script>
			// 안전재고 미달목록 출력/숨기기
		   let modalSearchData;
		   let mtlDate;
		    function pop(){
        	    $('#mtlLowGrid').toggle("size", 500);
       	    }		
		
			window.onload = function() {
				// 모달창
				const needModalGrid = new tui.Grid({
					el: document.getElementById('needModalGrid'),
					scrollX: false,	
					scrollY: false,
					contextMenu: null,
					rowHeaders:["checkbox"],
					pageOptions: {
			            perPage: 5,
			            useClient: true,
		            },
					columns: [
					{
						header: '자재',
						name: 'mtlCode',
						align: 'center'
					},
					{
						header: '거래처',
						name: 'bpCode',
						align: 'center'
					},
					{
						header: '발주일자',
						name: 'mtlDate',
						align: 'center'
					},
					{
						header: '담당자',
						name: 'mtlManager',
						align: 'center'
					},
					]
			    });								

			    $('#mtlSearch').on('click', function(){
                     setTimeout(() => needModalGrid.refreshLayout(), 200);
                 })

				// 안전재고미달 자재목록
				const mtlLowGrid = new tui.Grid({
					el : document.getElementById('mtlLowGrid'),
					scrollX : false,
					scrollY : false,
					rowHeaders : [ "rowNum" ],
					pageOptions: {
			            perPage: 5,
			            useClient: true,
			          },
					columns : [ {
						header : '자재코드',
						name : 'mtlCode',
					}, {
						header : '분류',
						name : 'mtlType'
					}, {
						header : '자재이름',
						name : 'mtlName'
					}, {
						header : '현재수량',
						name : 'mtlLotCnt'
					}, {
						header : '안전재고수량',
						name : 'mtlSs'
					}, {
						header : '수량차',
						name : 'mtlNow'
					}   ]
				});
			    // 미달목록그리드 클릭 이벤트
       			mtlLowGrid.on('dblclick',(ev)=>{
					alert('성공');
	        	});
				// 발주자재목록
				const mtlNeedGrid = new tui.Grid({
					el : document.getElementById('mtlNeedGrid'),
					scrollX : false,
					scrollY : false,
					rowHeaders : [ "rowNum" ],
					pageOptions: {
			            perPage: 10,
			            useClient: true,
			          },
					columns : [ {
						header : '자재코드',
						name : 'mtlCode',
						sortable: true,
					    sortingType: 'asc'
					}, {
						header : '자재발주일',
						name : 'mtlDate',
						sortable: true,
					    sortingType: 'asc'
					}, {
						header : '거래처이름',
						name : 'bpName',
						sortable: true,
					    sortingType: 'asc'
					}, {
						header : '분류',
						name : 'mtlType'
					}, {
						header : '자재이름',
						name : 'mtlName'
					}, {
						header : '수량',
						name : 'mtlCnt'
					}, {
						header : '단위',
						name : 'mtlUnit'
					}, {
						header : '담당자',
						name : 'mtlManager'
					}, {
						header : '납기요청일',
						name : 'mtlWishDate'
					}, {
						header : '상태',
						name : 'mtlWhereNm'
					}   ]
				});
				
				const header = ['mtlCode', 'mtlDate', 'bpName', 'mtlName', 'mtlCnt', 'mtlUnit', 'mtlManager','mtlWishDate','mtlWhereNm','mtlLotCnt','mtlSs','mtlNow','mtlType']
				
				//안전재고미달 ajax
		        $.ajax({
			          url: '/mtlMinus',
			          method: 'get',
			          dataType: 'json',
			          success: function (result) {
			            //날짜변환
			            $(result).each(function (idx, obj) {
			              for (let head of header) {

			                if (head.slice(-4).toLowerCase() == 'date') {
			                  obj[head] = getDate(obj[head]);
			                }
			              }
			            });
			            mtlLowGrid.resetData(eval(result));
			          },
			          error: function (err) {
			            console.log(err);
			          }
			        })
			        
				// 아래리스트 ajax
		        $.ajax({
		          url: '/insertNeedMtl',
		          method: 'POST',
		          dataType: 'json',
		          success: function (result) {
		            //날짜변환
		            $(result).each(function (idx, obj) {
		              for (let head of header) {

		                if (head.slice(-4).toLowerCase() == 'date') {
		                  obj[head] = getDate(obj[head]);
		                }
		              }
		            });
		            mtlNeedGrid.resetData(eval(result));
		          },
		          error: function (err) {
		            console.log(err);
		          }
		        })
			}
		</script>
	</div>
</body>
</html>