<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
    <meta charset="UTF-8">
    <title>생산계획조회</title>
</head> 
<style>
	
</style>
<body>
	<div layout:fragment="content">
	<h2>생산계획조회</h2>
		<div style="float:right; margin-bottom: 10px">
			<div class="input-group" >
				<div class="form-outline">
					<input type="search" id="form1" class="form-control" placeholder="계획명 또는 담당자"/> 
				</div>
				<button type="button" class="btn btn-primary" id="searchBtn">
					<i class="fas fa-search"></i>
				</button>
			</div>
		</div>
		<div id="grid" style="height: 400px;"></div>
    
    
      <script>
        let grid;
        let searchData;
        //const header = ['dtProdPlanCode','prdtName','prodPlanCnt','prodPlanName','prodRank','prodPlanDate','prodPlanSdate','prodPlanEdate']
        window.onload=function(){

	    const grid = new tui.Grid({
	      el: document.getElementById('grid'),
	      scrollX: false,
	      scrollY: false,
	      pageOptions: {
            perPage: 10,
            useClient: true,
          },
	      columns: [
	        {
	          header: '계획상세코드',
	          name: 'dtProdPlanCode'
	        },
	        {
	          header: '계획명',
	          name: 'prodName'
	        },
	        {
	          header: '계획담당자',
	          name: 'prodPlanName'
	        },
	        {
	          header: '제품명',
	          name: 'prdtName'
	        },
	        {
	          header: '수량',
	          name: 'prodPlanCnt'
	        },
	        {
	          header: '순위',
	          name: 'prodRank'
	        },
	        {
	          header: '생산계획일자',
	          name: 'prodPlanDate'
	        },
	        {
	          header: '생산시작일자',
	          name: 'prodPlanSdate'
	        },
	        {
	          header: '생산종료일자',
	          name: 'prodPlanEdate'
	        },
	        {
	        	 header: '지시여부',
	        	 name: 'prodInstYn'
	        }
	      ]
	    });
	    
		$.ajax({
			url:'/prodPlanList',
			method:'get',
	    	dataType:'json',

			success:function(result){
				for(let data of result){
					if(data.prodInstYn=='n'){
						data.prodInstYn = '지시전'
					} else{
						data.prodInstYn = '지시완료'
					}
				}
				grid.resetData(result);
			},
			error:function(err){
				console.log(err);
			}
		})
		
		$('#form1').on('keypress', function (ev) {
				if (ev.which == 13) {
					event.preventDefault();
					$('#searchBtn').click();
				}
			})
			
		$('#searchBtn').on('click', function(e){
			$.ajax({
				url:'/searchProd',
				method:'post',
				data : {
					prodName : $('#form1').val(),
					prodPlanName : $('#form1').val()
				},
				success:function(result){
					for(let data of result){
						if(data.prodInstYn=='n'){
							data.prodInstYn = '지시전'
						} else{
							data.prodInstYn = '지시완료'
						}
					}
					searchData = result;
					grid.resetData(result);
					setTimeout(() => grid.refreshLayout(), 800);
				},
				error:function(err){
					console.log(err);
				}
			})
		})
	  }
	  
    </script>
	</div>
</body>
</html>