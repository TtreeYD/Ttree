<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>완제품입고관리</title>
</head>
<body>
<div layout:fragment="content">
<h1>입고대기품목</h1>
<div id="chkListGrid" ></div>
<h1 style="margin-top:50px;">입고품목</h1>
<div class="btn-group" role="group" aria-label="Basic example" style="float : right;">
	<button class="btn btn-primary" style="float:right" id="recieveDtBtn">입고</button>
</div>
<div id="recieveGrid"></div>



<script>
const chkListGrid = new tui.Grid({
	el: document.getElementById('chkListGrid'),
	scrollX: false,
	scrollY: false,
	rowHeaders: ["rowNum"],
	pageOptions: {
        perPage: 5,
        useClient: true,
      },
	columns: [
		{
			header: '완제품검사코드',
			name: 'prdtChkCode',

		},
		{
			header: '제품코드',
			name: 'prdtCode',

		},
		{
			header: '제품명',
			name: 'prdtName',

		},
		{
			header: '검사량',
			name: 'prdtChkCnt',

		},
		{
			header: '검사날짜',
			name: 'prdtChkDate',

		},
		{
			header: '검사담당자',
			name: 'prdtManager',

		}],
})

const recieveGrid = new tui.Grid({
	el: document.getElementById('recieveGrid'),
	scrollX: false,
	scrollY: false,
	rowHeaders: ["rowNum"],
	
	columns: [
		{
			header: '완제품검사코드',
			name: 'prdtChkCode',

		},
		{
			header: '제품코드',
			name: 'prdtCode',

		},
		{
			header: '제품명',
			name: 'prdtName',

		},
		{
			header: '입고량',
			name: 'prdtRecieveCnt',
			editor: 'text'

		},
		{
			header: '입고날짜',
			name: 'prdtRecieveDate',
			editor: 'datePicker'

		},
		{
			header: '입고담당자',
			name: 'recieveManager',
			editor: 'text'
		}],
})

	getprdtCheckList();
	// 제품검사목록 조회
	function getprdtCheckList(){
		$.ajax({
			url:'/prdtFinChkList',
			method:'get',
	   	 	dataType:'json',
			success:function(result){
				chkListGrid.resetData(result);
			},
			error:function(err){
				console.log(err);
			}
		})
	}
	chkListGrid.on('dblclick',function(ev){
		let rowKey = chkListGrid.getFocusedCell().rowKey
		if(rowKey != null && rowKey >=0){
			let prdtChkCode = chkListGrid.getValue(rowKey , 'prdtChkCode');
			let prdtCode = chkListGrid.getValue(rowKey , 'prdtCode');
			let prdtName = chkListGrid.getValue(rowKey , 'prdtName');
			let prdtChkCnt = chkListGrid.getValue(rowKey , 'prdtChkCnt');
			chkListGrid.removeRow(rowKey);
			recieveGrid.appendRow(
				{
				prdtChkCode: prdtChkCode,
				prdtCode : prdtCode,
				prdtName : prdtName,
				prdtRecieveCnt : prdtChkCnt
				},
				{at:0}
			);
		}
	});
	$('#recieveDtBtn').on('click',function(){
		let data={}; 
		data.list= recieveGrid.getData();
		console.log(data)
		$.ajax({
			url:'/recievePrdt',
			method:'POST',
			dataType: 'json',
			contentType : 'application/json',
			data:JSON.stringify(data),
			success:function(result){
				console.log(result)
				toastr.options.positionClass = "toast-top-center";
                toastr.options.escapeHtml = true;
                toastr.options.closeButton = true;
                toastr.options.newestOnTop = false;
                toastr.options.timeOut= 1250;
                toastr.success('입고완료');
			},
			error:function(err){
				console.log(err);
			}
		})
	})
	
</script>
</div>
</body>
</html>