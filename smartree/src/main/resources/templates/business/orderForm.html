<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">

<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
</head>

<body>
	<div layout:fragment="content">
		<h2 style="height:0px">주문정보</h2>
		<div class="btn-group" role="group" aria-label="Basic example" style="float : right;">
			<button class="btn btn-primary" style="float:right" id="searchOrder">검색</button>
			<button class="btn btn-primary" style="float:right" id="resetBtn">초기화</button>
			<button class="btn btn-primary" style="float:right" id="saveBtn">저장</button>
			<button class="btn btn-primary" style="float:right">새주문서</button>
			<button class="btn btn-primary" style="float:right">삭제</button>
		</div>
		<div id="order"></div>
		<h2 style="height : 0px;margin-top:200px">주문상세정보</h2>
		<div class="btn-group" role="group" aria-label="Basic example" style="float : right;">
			<button class="btn btn-primary" style="float:right">추가</button>
			<button class="btn btn-primary" style="float:right">저장</button>
		</div>
		<div id="dtOrder"></div>


		<div class="modal fade" tabindex="-1" role="dialog" id="myModal">
			<div class="modal-dialog modal-dialog-centered modal-xl" role="document">
				<div class="modal-content">
					<h2 style="margin:30px">주문서검색</h2>
					<div style="margin: 0 auto;">
						<label for="ordercd" style="text-align:center;">주문코드</label>
						<input type="text" id="ordercd" class="form-control" placeholder="주문코드를 입력하세요" name="ordercd"
							style="width:500px">
						<label for="plsdate" style="margin-top:10px">접수일자</label>
						<input type="date" id="plsdate" class="form-control" name="plsdate" style="width:500px">
						<label for="doddate" style="margin-top:10px">납기일자</label>
						<input type="date" id="doddate" class="form-control" name="doddate" style="width:500px">
					</div>
					<div style="display: flex; justify-content: center; margin-top:10px;">
						<button type="button" id="searchDataBtn" class="btn btn-primary"
							style="margin: 5px;">조회</button>
						<button type="button" id="resetModalBtn" class="btn btn-primary"
							style="margin: 4px;" >초기화</button>
					</div>
					<div class="modal-body">
						<div id="searchModal"></div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->



		<script>
			let searchModalData;
			
			$(document).ready(function () {
				//주문그리드
				const order = new tui.Grid({
					el: document.getElementById('order'),
					scrollX: false,
					scrollY: true,
					columns: [
						{
							header: '주문코드',
							name: 'orderCode',
						},
						{
							header: '업체코드',
							name: 'bpCode',
						},
						{
							header: '업체명',
							name: 'bpName',
						},
						{
							header: '주문일자',
							name: 'orderDate',
							editor: 'datePicker'
				        },
						
						{
							header: '납기일자',
							name: 'dodDate',
							editor: 'datePicker'
						},
						{
							header: '담당자',
							name: 'orderManager',
							editor: 'text'
						},
					]
				})
				//상세보기그리드
				const dtOrder = new tui.Grid({
					el: document.getElementById('dtOrder'),
					scrollX: false,
					scrollY: true,
					rowHeaders: ['checkbox'],
					columns: [
						{
							header: '주문상세코드',
							name: 'orderDtCode',
						},
						{
							header: '제품명',
							name: 'prdtName',
						},
						{
							header: '제품코드',
							name: 'prdtCode',
							
						},
						{
							header: '수량',
							name: 'orderDtCnt',
							editor: 'text'
						},

					]
				});
				//모달그리드
				const searchModal = new tui.Grid({
					el: document.getElementById('searchModal'),
					scrollX: false,
					scrollY: true,
					columns: [
						{
							header: '주문코드',
							name: 'orderCode',
						},
						{
							header: '업체코드',
							name: 'bpCode',
						},
						{
							header: '업체명',
							name: 'bpName',
						},
						{
							header: '주문일자',
							name: 'orderDate',
						},
						{
							header: '납기일자',
							name: 'dodDate',
						},
						{
							header: '담당자',
							name: 'orderManager',
						},
					]
				})
				
				//검색 클릭이벤트-모달띄우기
				$('#searchOrder').on('click', function () {
					$('#ordercd').val('');
					$('#plsdate').val('');
					$('#doddate').val('');
					$("#myModal").modal('show');
					
				});
				//조회 처리이벤트
				$('#searchDataBtn').on('click',function(ev){		
					$.ajax({
						url:'/selectOrder',
						method: 'POST',
						data:{
							orderCode: $('#ordercd').val(),
							orderDate: $('#plsdate').val(),
							dodDate:$('#doddate').val()

						},
						success:function(result){
							searchModalData = result;
							searchModal.resetData(result);
					 		setTimeout(() => searchModal.refreshLayout(), 200);
					 		
							
						},
						error:function(err){
							console.log(err);
						}
					})
						
					});
				
					//해당열 더블클릭이벤트
					searchModal.on('dblclick',(ev)=>{
						if(ev.rowKey==undefined){
			        		return;
			        	}
						let data = searchModal.getValue(ev.rowKey,'orderCode');
						console.log(data);
						
						$.ajax({
							url:'/orderDtList',
							method:'GET',
							data:{
								orderCode:data
							},
							success:function(result){
								$('#myModal').modal('hide');
								order.resetData(eval([searchModalData[ev.rowKey]]));
								dtOrder.resetData(result);
								searchModalData = searchModalData[ev.rowKey];//불러온 해당 열 변수에 저장
								
							},
							error:function(err){
								console.log(err)
							}
							
							
						})
					})
					//초기화 - 주문서 ,주문서상세 초기화
					$('#resetBtn').on('click',function(){						
						order.resetData([]);
						dtOrder.resetData([]);
					});
					//모달창초기화 - 검색input창 초기화
					$('#resetModalBtn').on('click',function(){	
						searchModal.resetData([]);
						$('#ordercd').val('');
						$('#plsdate').val('');
						$('#doddate').val('');
					});
					$('#saveBtn').on('click',function(){
						let editdata={};
						editdata.vo = order.getData();
						editdata.list = dtOrder.getData();
						console.log(editdata);
						if(searchModalData.orderCode != ''){//수정
							/* $.ajax({
								url:'',
								method:'POST',
								dataType: 'json',
								contentType : 'application/json',
								data:JSON.stringify(){
									
								}
							}) */
						}else{//등록
							
						}
						
					});
					
				})

			
		</script>
	</div>
</body>

</html>