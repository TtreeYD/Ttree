<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>SMARTREE</title>
<style>
#grid tbody td, #grid2 tbody td{
			cursor : pointer;
		}

.tui-grid-cell.red {background-color: red;}
.tui-grid-cell.green {background-color: lime;}
#toast-container > .toast-error { 
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHOSURBVEhLrZa/SgNBEMZzh0WKCClSCKaIYOED+AAKeQQLG8HWztLCImBrYadgIdY+gIKNYkBFSwu7CAoqCgkkoGBI/E28PdbLZmeDLgzZzcx83/zZ2SSXC1j9fr+I1Hq93g2yxH4iwM1vkoBWAdxCmpzTxfkN2RcyZNaHFIkSo10+8kgxkXIURV5HGxTmFuc75B2RfQkpxHG8aAgaAFa0tAHqYFfQ7Iwe2yhODk8+J4C7yAoRTWI3w/4klGRgR4lO7Rpn9+gvMyWp+uxFh8+H+ARlgN1nJuJuQAYvNkEnwGFck18Er4q3egEc/oO+mhLdKgRyhdNFiacC0rlOCbhNVz4H9FnAYgDBvU3QIioZlJFLJtsoHYRDfiZoUyIxqCtRpVlANq0EU4dApjrtgezPFad5S19Wgjkc0hNVnuF4HjVA6C7QrSIbylB+oZe3aHgBsqlNqKYH48jXyJKMuAbiyVJ8KzaB3eRc0pg9VwQ4niFryI68qiOi3AbjwdsfnAtk0bCjTLJKr6mrD9g8iq/S/B81hguOMlQTnVyG40wAcjnmgsCNESDrjme7wfftP4P7SP4N3CJZdvzoNyGq2c/HWOXJGsvVg+RA/k2MC/wN6I2YA2Pt8GkAAAAASUVORK5CYII=") !important; 
} 
#toast-container > .toast-success { 
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADsSURBVEhLY2AYBfQMgf///3P8+/evAIgvA/FsIF+BavYDDWMBGroaSMMBiE8VC7AZDrIFaMFnii3AZTjUgsUUWUDA8OdAH6iQbQEhw4HyGsPEcKBXBIC4ARhex4G4BsjmweU1soIFaGg/WtoFZRIZdEvIMhxkCCjXIVsATV6gFGACs4Rsw0EGgIIH3QJYJgHSARQZDrWAB+jawzgs+Q2UO49D7jnRSRGoEFRILcdmEMWGI0cm0JJ2QpYA1RDvcmzJEWhABhD/pqrL0S0CWuABKgnRki9lLseS7g2AlqwHWQSKH4oKLrILpRGhEQCw2LiRUIa4lwAAAABJRU5ErkJggg==") !important; 
} 
#toast-container > .toast-warning { 
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGYSURBVEhL5ZSvTsNQFMbXZGICMYGYmJhAQIJAICYQPAACiSDB8AiICQQJT4CqQEwgJvYASAQCiZiYmJhAIBATCARJy+9rTsldd8sKu1M0+dLb057v6/lbq/2rK0mS/TRNj9cWNAKPYIJII7gIxCcQ51cvqID+GIEX8ASG4B1bK5gIZFeQfoJdEXOfgX4QAQg7kH2A65yQ87lyxb27sggkAzAuFhbbg1K2kgCkB1bVwyIR9m2L7PRPIhDUIXgGtyKw575yz3lTNs6X4JXnjV+LKM/m3MydnTbtOKIjtz6VhCBq4vSm3ncdrD2lk0VgUXSVKjVDJXJzijW1RQdsU7F77He8u68koNZTz8Oz5yGa6J3H3lZ0xYgXBK2QymlWWA+RWnYhskLBv2vmE+hBMCtbA7KX5drWyRT/2JsqZ2IvfB9Y4bWDNMFbJRFmC9E74SoS0CqulwjkC0+5bpcV1CZ8NMej4pjy0U+doDQsGyo1hzVJttIjhQ7GnBtRFN1UarUlH8F3xict+HY07rEzoUGPlWcjRFRr4/gChZgc3ZL2d8oAAAAASUVORK5CYII=") !important; 
} 
.toast { 
  background-color: #030303; 
} 
.toast-error { 
  background-color: #bd362f; 
} 
.toast-success { 
  background-color: #51a351; 
} 
.toast-warning { 
  background-color: #f89406; 
} 
</style>
</head>
<body>
<div layout:fragment="content">
<h2>제품품질검사</h2>
	<div style="display: flex; flex-wrap: nowrap; justify-content: space-around; margin-top: 30px;">
		<div>
			<h3>권민석</h3>
			<div id="grid" style="width: 800px;"></div>
		</div> 
		<div>
		<button type="button" id="addBtn" class="btn btn-primary" style="float : right;">저장</button>
			<h3>권민석</h3>
			<div id="grid2" style="width: 800px;"></div>
		</div>
	</div>
	
	
	
	
	<script>
	//window.onload=function(){

	    const grid = new tui.Grid({
	      el: document.getElementById('grid'),
	      scrollX: false,
	      scrollY: false,
	      pageOptions: {
            perPage: 5,
            useClient: true,
          },
          rowHeaders : ["rowNum"],
          bodyHeight : 400,
	      columns: [
    	    {
	          header: '생산지시코드',
	          name: 'prodInstCode',
	          align: 'center'
	        },
	        {
	          header: '공정실적코드',
	          name: 'prcsRsCode',
	          align: 'center'
	        },
	        {
	          header: '생산지시일자',
	          name: 'prodInstDate',
	          align: 'center'
	        },
	        {
	          header: '검사량',
	          name: 'passCnt',
	          align: 'center',
	          editor : 'text',
	        },
	        {
	          header: '제품코드',
	          name: 'prdtCode',
	          align: 'center',
	          },
		
	      ]
	    });
	    const grid2 = new tui.Grid({
		      el: document.getElementById('grid2'),
		      scrollX: false,
		      scrollY: false,
	          bodyHeight : 400,
		      columns: [
		        {
		          header: '검사기준코드',
		          name: 'chkStdCode',
		          align: 'center',
		        },
		        {
		          header: '검사명',
		          name: 'chkName',
		          align: 'center'
		        },
		        {
		          header: '검사기준',
		          name: 'chkStd',
		          align: 'center'
		        },
		        {
		          header: '검사값',
		          name: 'prdtChkVal',
		          editor : 'text',
		          align: 'center'
		        },
		        {
		          header: '적합여부',
		          name: 'prdtChkFit',
		          align: 'center'
		        },
		        {
		          header: '담당자',
		          name: 'prdtManager',
		          editor : 'text',
		          align: 'center',
		         
		        },
		      ],
		       
		    });
	    getprdtCheckList();
	    
	   let prcsRsCode;
  	   let chkList = {};
  	   
  	 	toastr.options = {
  			  positionClass: "toast-top-center",
  			  escapeHtml: true,
  			  closeButton: true,
 			  newestOnTop: false,
  			  timeOut: 1250
  			};
  	   
	    //제품검사목록 
	    function getprdtCheckList(){

	    	$.ajax({
	    		url:'/prodCheckList',
	    		method:'get',
	       	 	dataType:'json',
	    		success:function(result){
	    			console.log(result);
	    			grid.resetData(result);
	    		},
	    		error:function(err){
	    			console.log(err);
	    		}
	    	})
	    }
	    
	   grid.on('click',(ev)=>{
	    	const prdtCode = grid.getValue(ev.rowKey,'prdtCode');
	    	
	    	$.ajax({
	    		url:'/prodDtList',
	    		method:'get',
	    		data : {  prdtCode  },
	       	 	dataType:'json',
	    		success:function(result){
	    			console.log(result);
	    			grid2.resetData(result);
	    		},
	    		error:function(err){
	    			console.log(err);
	    		}
	    	});
	    }) 
	    
	  
	    //자동 계산
	       grid2.on('afterChange', (ev) => {
	      console.log(ev);
	      let change = ev.changes[0];
	      let rowData = grid2.getRow(change.rowKey);
	      console.log(rowData)
	      let firstNum = parseFloat(rowData.prdtChkVal);
	      let secNum = parseFloat(rowData.chkStd);
	      
		  	      
	      if(change.columnName == 'prdtChkVal'){
	         if(firstNum != null && firstNum != ""){
	            let prdtChkFit;
	            let attributes = {}
	            let data = grid2.getRow(change.rowKey)
	            
	            if(firstNum < secNum){
	            	prdtChkFit = '적합';
	            	attributes = {
	            			className:{
	            				column : {
	            					prdtChkFit : ['green']
	            				}
	            			}
	            	}
	            } else if(firstNum >= secNum){
	            	prdtChkFit = '부적합';
	            	attributes = {
	            			className:{
	            				column : {
	            					prdtChkFit : ['red']
	            				}
	            			}
	            	}
	            }
            	data.prdtChkFit = prdtChkFit
            	data._attributes = attributes
	            grid2.setRow(change.rowKey, data)
	         }
	      }
	      }); 

	   	//저장버튼 이벤트
	   	$('#addBtn').on('click',function(){

	   		chkList.chkData = grid.getData();
	   		chkList.chkDtData= grid2.getData();
	   		console.log('123123',chkList);
	   		let datas = grid2.getData();
	   		$.ajax({
				url: '/insertProdChk', 
				method: 'post',
				dataType: 'json',
				contentType : 'application/json',
				data : JSON.stringify(chkList),
				success: function(result) {
					if(result > 0){
						toastr.success('저장완료');
						$.ajax({
							url : '/updatePrdtFinChk',
							method : 'get',
							
							success: function(result){

							},
							error: function(err) {
								console.log(err);
							}
							
						})
					}
				},
				error: function(err) {
					console.log(err);
				}
			});
	   	})
	   
	   

	//};
	</script>
	</div>
</body>
</html>