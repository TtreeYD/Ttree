<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<head>
<meta charset="UTF-8">
<title>SMARTREE</title>
<style>
#grid tbody td {
	cursor: pointer;
}

.tui-grid-cell.red {
	background-color: rgb(227, 52, 52);
	color: white;
	font-weight: bolder;
}

.tui-grid-cell.green {
	background-color: rgb(31, 193, 31);
	color: white;
	font-weight: bolder;
}

</style>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src=" https://code.highcharts.com/modules/exporting.js"></script>
</head>

<body>
	<div layout:fragment="content">
		<h2>제품품질검사조회</h2>
		<div
			style="display: flex; flex-wrap: nowrap; justify-content: space-around; margin-top: 30px;">
			<div>
				<h3>품질검사목록</h3>
				<div id="grid" class="lightgrey" style="width: 800px;"></div>
			</div> <div>
				<h3>품질검사상세</h3>
				<div id="grid2" style="width: 800px;"></div>
				<button type="button" id="pdfDownload" class="btn btn-primary" style="float : right;">pdf저장</button>
			</div>
		</div>
		<div id="container" style="width: 800px; height: 400px;"></div>
		
<script>
	window.onload=function(){
		
	    const grid = new tui.Grid({
	      el: document.getElementById('grid'),
	      scrollX: false,
	      scrollY: false,
	      pageOptions: {
            perPage: 5,
            useClient: true,
          },
          rowHeaders : ["rowNum"],
          bodyHeight : 400,
	      columns: [
	        {
	          header: '제품검사코드',
	          name: 'prdtChkCode',
	          align: 'center'
	        },
	        {
	          header: '공정실적코드',
	          name: 'prcsRsCode',
	          align: 'center'
	        },
	        {
	          header: '제품코드',
	          name: 'prdtCode',
	          align: 'center'
	        },
	        {
	          header: '제품명',
	          name: 'prdtName',
	          align: 'center'
	        },
	        {
	          header: '검사량',
	          name: 'prdtChkCnt',
	          align: 'center'
	        },
	        {
	          header: '검사결과',
	          name: 'prdtChkResult',
	          align: 'center'
	        },
	        {
	          header: '검사날짜',
	          name: 'prdtChkDate',
	          align: 'center'
	        },
	        {
	          header: '담당자',
	          name: 'prdtManager',
	          align: 'center'
	        },
	      ]
	    });
	    const grid2 = new tui.Grid({
		      el: document.getElementById('grid2'),
		      scrollX: false,
		      scrollY: false,
	          bodyHeight : 400,
		      columns: [
		        {
		          header: '제품검사코드',
		          name: 'prdtChkCode',
		          align: 'center'
		        },
		        {
		          header: '공정실적코드',
		          name: 'prcsRsCode',
		          align: 'center'
		        },
		        {
		          header: '검사명',
		          name: 'chkName',
		          align: 'center'
		        },
		        {
		          header: '검사기준',
		          name: 'chkStd',
		          align: 'center'
		        },
		        {
		          header: '검사값',
		          name: 'prdtChkVal',
		          align: 'center'
		        },
		        {
		          header: '적합여부',
		          name: 'prdtChkFit',
		          align: 'center',
		          },   
		      ]
		    });
	    getprdtCheckList();
	    
	 // 제품검사목록 조회
	    function getprdtCheckList(ev){
			
	    	$.ajax({
	    		url:'/prdtCheckList',
	    		method:'get',
	       	 	dataType:'json',
	    		success:function(result){
	    			console.log(result);
	    			grid.resetData(result);
	    		},
	    		error:function(err){
	    			console.log(err);
	    		}
	    	})
	    }
	    
	    // 제품검사상세목록 조회
	    grid.on('click',(ev)=>{
	    	const prdtChkCode = grid.getValue(ev.rowKey, 'prdtChkCode')  
	    	const rowData = grid.getRow(ev.rowKey);
			console.log(rowData);
			console.log(ev);
			console.log(ev.rowKey);
			console.log(rowData.rowKey);
	    	$.ajax({
	    		url:'/dtList',
	    		method:'get',
	    		data : {  prdtChkCode  },
	       	 	dataType:'json',
	    		success:function(result){
	    			for(let item of result){
	    				if(item.prdtChkFit==='적합'){
	    					item._attributes= {
	    	            			className:{
	    	            				column : {
	    	            					prdtChkFit : ['green']
	    	            				}
	    	            			}
	    		            	}
	    				} else {
	    					item._attributes= {
	    	            			className:{
	    	            				column : {
	    	            					prdtChkFit : ['red']
	    	            				}
	    	            			}
	    		            	}
	    				}
	    			}
	    			grid2.resetData(result);

	    		},
	    		error:function(err){
	    			console.log(err);
	    		}
	    	});
	    });
		
	    Highcharts.chart('container', {
	        chart: {
	            type: 'spline',
	            animation: Highcharts.svg, // don't animate in old IE
	            marginRight: 10,
	            events: {
	                load: function () {

	                    // set up the updating of the chart each second
	                    var series = this.series[0];
	                    setInterval(function () {
	                        var x = (new Date()).getTime(), // current time
	                            y = Math.random();
	                        series.addPoint([x, y], true, true);
	                    }, 1000);
	                }
	            }
	        },

	        time: {
	            useUTC: false
	        },

	        title: {
	            text: 'Live random data'
	        },

	        accessibility: {
	            announceNewData: {
	                enabled: true,
	                minAnnounceInterval: 15000,
	                announcementFormatter: function (allSeries, newSeries, newPoint) {
	                    if (newPoint) {
	                        return 'New point added. Value: ' + newPoint.y;
	                    }
	                    return false;
	                }
	            }
	        },

	        xAxis: {
	            type: 'datetime',
	            tickPixelInterval: 150
	        },

	        yAxis: {
	            title: {
	                text: 'Value'
	            },
	            plotLines: [{
	                value: 0,
	                width: 1,
	                color: '#808080'
	            }]
	        },

	        tooltip: {
	            headerFormat: '<b>{series.name}</b><br/>',
	            pointFormat: '{point.x:%Y-%m-%d %H:%M:%S}<br/>{point.y:.2f}'
	        },

	        legend: {
	            enabled: false
	        },

	        exporting: {
	            enabled: false
	        },

	        series: [{
	            name: 'Random data',
	            data: (function () {
	                // generate an array of random data
	                var data = [],
	                    time = (new Date()).getTime(),
	                    i;

	                for (i = -19; i <= 0; i += 1) {
	                    data.push({
	                        x: time + i * 1000,
	                        y: Math.random()
	                    });
	                }
	                return data;
	            }())
	        }]
	    });

	};
	</script>
	</div>
</body>
</html>