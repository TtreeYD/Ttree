<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">

<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
</head>

<body>
	<div layout:fragment="content">
		<div class="container-xxl text-center">
			<div class="row">
				<div class="col-4">
					<button type="button" id="addCommonCode" class="btn btn-primary" style="float:left;">등록</button>
					<br>
					<br>
					<div id="commonCodeGrid"></div>
				</div>
				<div class="col-8">
					<button type="button" id="addCodeDetail" class="btn btn-primary" style="float:right;"
					data-toggle="modal" data-target="#addCodeDetailModal">등록</button>
					<br>
					<br>
					<div id="codeDetailGrid"></div>
				</div>
			</div>
		</div>
		<!-- 코드분류등록 -->
		<div class="modal fade " id="addCommonCodeModal" tabindex="-1" role="dialog" 
			aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">사원등록</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<label>공통코드</label>
						<input id="codeType" name="codeType">
						<br>
						<label>코드명</label>
						<input id="typeName" name="typeName">
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary">등록</button>
						<button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
					</div>
				</div>
			</div>
		</div>
		<!-- 코드상세등록 -->
		<div class="modal fade " id="addCodeDetailModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
			aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">사원등록</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<label>상세코드</label>
						<input id="codeId" name="codeId">
						<br>
						<label>상세코드명</label>
						<input id="codeName" name="codeName">
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary">등록</button>
						<button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
					</div>
				</div>
			</div>
		</div>
		
		<script>
			var Grid = tui.Grid;
			let commonCode=[];
			let codeType;

			const grid = new Grid({
				el: document.getElementById('commonCodeGrid'),
				scrollX: false,
				bodyHeight: 600,
				contextMenu: null,
				columns: [{
					header: '공통코드',
					name: 'codeType'
				}, {
					header: '코드명',
					name: 'typeName'
				}]
			});
			let gridData;
			const grid2 = new Grid({
				el: document.getElementById('codeDetailGrid'),
				scrollX: false,
				bodyHeight: 600,
				columns: [{
					header: '상세코드',
					name: 'codeId'
				}, {
					header: '상세코드명',
					name: 'codeName'
				}, {
					header: '사용여부',
					name: 'codeUse',
					editor: {
		            type: 'select',
		            options: {
		              listItems: [
		                { text: 'Y', value: 'Y' },
		                { text: 'N', value: 'N' }
		              ]
		            }
		          }
				}]
			});
		
			grid.on('dblclick', function (ev) {
				codeType = grid.getValue(ev.rowKey, 'codeType')
				$.ajax({
					url: "/selectCommonCode",
					data: {
						codeType: codeType
					},
					success: result => {
						console.log(result)
						grid2.resetData(eval(result))
					},
					error: err => console.log(err)
				})
			})


			selCodeType();

			function selCodeType() {
				$.ajax({
					url: "/selectCommonCodeType",
					success: result => {
						commonCode = result
						grid.resetData(commonCode);
					},
					error: err => console.log(err)
				})
			}
			
			$(addCommonCode).on('click', function () {
				commonCode.push({
					codeType: '',
					typeName: ''
				})
				grid.resetData(commonCode)
			})
		</script>
	</div>
</body>

</html>